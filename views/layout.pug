mixin key(key)
  each dir in key.split(/(?=\/)/)
    if dir.length < 32
      span(data-unbreakable=true)= dir
    else
      each chunk in dir.split(/(\w{20,})/).filter(chunk => chunk)
        span(data-breakable=chunk.search(/^\w{20,}/) === 0)= chunk
    if ! dir.endsWith('..')
      wbr

mixin keynav(key)
  a(href='.'): +key(path.dirname(key))
  if path.dirname(key) != '/'
    | /
  +key(path.basename(key))

mixin value(value)
  if types.is(value, 'array')
    each elt, idx in value
      if idx
        | ,
      |  #{elt}
  else
    = value

mixin editvalue(grade)
  if types.is(grade.value, 'string') && grade.key.endsWith('-comment')
    textarea(name=grade.key, rows=3, cols=30)=grade.value
  else if types.is(grade.value, 'boolean number string')
    input(type='text', name=grade.key, value=''+grade.value, size=10)
  else
    | Cannot edit #{types.which(grade.value, types.value_types)}

mixin ts(ts)
  if ts
    = types.dateTimeString(new Date(ts))

mixin plural(count, singular, plural)
  | #{count} #{count == 1 ? singular : plural ? plural : singular + 's'}

doctype
html
  head
    block head
      meta(name='viewport', content='width=device-width, initial-scale=1')
      link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css')
      link(rel='stylesheet', href='/web/style.css')
  body(class=[ errorpage ? 'errorpage' : null, staffpage ? 'staffpage' : null ])
    nav.navbar.navbar-fixed-top
      div(class=[ fullpage ? 'container-fluid' : 'container' ])
        p.navbar-text
          if course
            a.navbar-link(href='/'+course) Omnivore #{course}
          else
            a.navbar-link(href='/') Omnivore
        p.navbar-text.navbar-right #{authuser}
    div(class=[ fullpage ? 'container-fluid' : 'container' ])
      block content
    nav.navbar.navbar-bottom
      div(class=[ fullpage ? 'container-fluid' : 'container' ])
        p.navbar-text.nom
        p.navbar-text.navbar-right MIT EECS
    block scripts
      script(src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js')
      script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js')
      script(src='/web/script.js')
